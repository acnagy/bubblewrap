#!/usr/bin/env python3

"""
bubblewrap is a a wrapper around pytest for assessing flakiness and runtime regressions

example invocation: 

bubblewrap ~/path/to/project --trials 10 --compare-to ffe6831 --fail-on-warn
"""

import os
import argparse

from cli import bubblewrap

if __name__ == '__main__':
    parser = argparse.ArgumentParser(
        "assess flakiness and runtime regression in tests"
    )

    parser.add_argument("path", help='add the relative path to the project location')
    parser.add_argument("--trials", "-t", metavar="\b", required=False, default=30, type=int, help="number of trials for benchmarking test regresions")
    parser.add_argument("--compare-to", "-c", metavar="\b", required=False, default="HEAD~1", type=str, help="git commit to compare against")
    parser.add_argument("--fail-on-warn", "-f", required=False, action='store_true', help="fail tests if results warn of flakiness/regresions")
    args = parser.parse_args()

    bubblewrap(path=args.path, trials=args.trials, prev_commit=args.compare_to, fail=args.fail_on_warn)
